<vcl-drawer-container
  (backdropClick)="toggleSidebar()"
  class="layout-shell-container"
>
  <vcl-drawer
    [mode]="(isHandset$ | async) ? 'over' : 'side'"
    [opened]="(collapsed$ | async) === false"
  >
    <vcl-navigation class="h-100p layout-shell-navigation">
      <div class="row justify-content-between py-1 px-2">
        <rc-brand
          [brandName]="config.appName"
          [logoUrl]="config.logoUrl"
          [logoWidth]="config.logoWidth ?? 100"
        />
        <button
          vcl-button
          square
          class="transparent"
          [title]="
            (collapsed$ | async)
              ? (label$(config.uiText?.showSidebar || 'Show sidebar') | async)
              : (label$(config.uiText?.hideSidebar || 'Hide sidebar') | async)
          "
          (click)="toggleSidebar()"
        >
          <vcl-icon
            [class]="iconClass"
            [icon]="(icon$ | async) || ''"
          />
        </button>
      </div>

      @if (isHandset$ | async) { @if (categories$ | async; as categories) {
      <div class="my-2 px-2">
        <rc-category-select
          [label]="(label$(config.uiText?.selectCategory || '') | async) || ''"
          [categories]="(categories$ | async) || []"
          [value]="activeCategory$ | async"
          (valueChange)="onSelectCategory($event)"
        />
      </div>
      } } @for (item of (facade.visibleNavItems$ | async); track $index) {
      <vcl-navigation-item
        #navItem="vclNavigationItem"
        [routerLink]="item.children?.length ? null : item.route"
        [routerLinkActive]="item.children?.length ? [] : ['selected']"
        queryParamsHandling="preserve"
        (click)="
          !item.children?.length && navigate(item); $event.stopPropagation()
        "
      >
        <vcl-navigation-label>
          <vcl-icogram>
            @if (item.children?.length) {
            <vcl-icon
              vclPrepend
              [icon]="navItem.opened ? 'vcl:chevron-down' : 'vcl:chevron-right'"
            ></vcl-icon>
            } @if (!item.children?.length) {
            <vcl-icon
              vclPrepend
              [icon]="item.icon"
            ></vcl-icon>
            }

            {{ label$(item.label) | async }}
          </vcl-icogram>
        </vcl-navigation-label>

        @if (item.children?.length) {
        <vcl-navigation>
          @for (child of item.children; track $index) {
          <vcl-navigation-item
            [routerLink]="child.route"
            [routerLinkActive]="['selected']"
            queryParamsHandling="preserve"
            (click)="navigate(child); $event.stopPropagation()"
          >
            <vcl-navigation-label>
              <vcl-icogram>
                <vcl-icon
                  vclPrepend
                  [icon]="child.icon"
                ></vcl-icon>
                {{ label$(child.label) | async }}
              </vcl-icogram>
            </vcl-navigation-label>
          </vcl-navigation-item>
          }
        </vcl-navigation>
        }
      </vcl-navigation-item>
      }

      <div class="py-1 px-2 rs-navigation-item-bottom-container">
        @if ((isHandset$ | async) === false) { @if (categories$ | async; as
        categories) {
        <rc-category-select
          [label]="(label$(config.uiText?.selectCategory || '') | async) || ''"
          [categories]="categories"
          [value]="activeCategory$ | async"
          (valueChange)="onSelectCategory($event)"
        />
        } } @if (footerConfig.enabled) {
        <div class="vcl-text-muted vcl-text-xs mt-2">
          @if (footerConfig.showYear) { Â© {{ footerConfig.year }}
          } @if (footerConfig.companyName) { @if (footerConfig.companyUrl) {
          <a
            [href]="footerConfig.companyUrl"
            target="_blank"
            rel="noopener noreferrer"
            class="vcl-link"
          >
            {{ footerConfig.companyName }}
          </a>
          } @else {
          {{ footerConfig.companyName }}
          } } @if (footerConfig.text) { .
          {{ label$(footerConfig.text) | async }}
          }
        </div>
        }
      </div>
    </vcl-navigation>
  </vcl-drawer>

  <header class="row align-items-center px-2">
    @if (collapsed$ | async) {
    <button
      vcl-button
      square
      class="transparent"
      [title]="label$(config.uiText?.showSidebar ?? 'Show sidebar') | async"
      (click)="toggleSidebar()"
    >
      <vcl-icon
        [class]="iconClass"
        [icon]="(icon$ | async) || ''"
      />
    </button>
    }

    <ng-content select="[layoutHeader]">
      <rc-breadcrumb
        [rootLabel]="'Home'"
        [rootUrl]="'/'"
        [breadcrumbsToExclude]="['Home']"
      />

      <div class="flex"></div>

      <rc-header-toolbar
        [organizations]="organizations"
        [user]="user"
        [selectedOrganizationId]="selectedOrganizationId"
        (organizationSelected)="onSelectOrganization($event)"
        (accountAction)="onAccountItemSelected($event)"
        (searchChange)="onSearchChange($event)"
      />
    </ng-content>
  </header>

  <main class="flex px-2 rs-main">
    <ng-content />
  </main>
</vcl-drawer-container>
