@if (order(); as order) {
<rc-resource-detail
  [title]="'Order details'"
  (back)="goBack()"
  (edit)="editOrder()"
  (delete)="deleteOrder()"
>
  <header class="mb-3 row justify-between">
    <div class="title">
      <h3 class="m-0 mb-2">Order {{ order.id }}</h3>
      <vcl-badge>{{ order.status }}</vcl-badge>
    </div>

    <div class="actions mt-2">
      <!-- TODO Move these to the toolbar.... -->
      <!-- slot: add buttons like "Cancel", "Refund", "Resend email" -->
      <!-- <button
        vcl-button
        class="emphasized-transparent scale85p"
      >
        Create fulfilment
      </button>

      <button
        vcl-button
        class="ml-2 emphasized-transparent scale85p"
      >
        Create invoice
      </button> -->
    </div>
  </header>

  <vcl-tab-nav [selectedTabIndex]="0">
    <vcl-tab>
      <vcl-label>Basic</vcl-label>
      <div class="row grid-gutter-1">
        <div class="flex-6">
          <div class="secondary-text-color scale85p">Destination</div>
          <div>{{ destination() }}</div>
        </div>
        <div class="flex-6">
          <div class="secondary-text-color scale85p">Items</div>
          <div>{{ itemCount() }}</div>
        </div>
      </div>

      <hr />

      <div class="row grid-gutter-1">
        <div class="flex-4">
          <div class="secondary-text-color scale85p">Customer</div>
          <div>{{ customerDisplayName() }}</div>
          <div class="secondary-text-color scale85p">{{ customer()?.id }}</div>
        </div>

        <div class="flex-4">
          <div class="secondary-text-color scale85p">Email</div>
          <div>{{ customerEmail() }}</div>
        </div>

        <div class="flex-4">
          <div class="secondary-text-color scale85p">Customer type</div>
          <div>{{ customerTypeLabel() }}</div>
        </div>
      </div>

      <hr />
      <!-- Totals -->
      <div class="row grid-gutter-1">
        <div class="flex-4">
          <div class="secondary-text-color scale85p">Subtotal</div>
          <div>{{ formattedMoney(totals()?.subtotal) }}</div>
        </div>

        <div class="flex-4">
          <div class="secondary-text-color scale85p">Tax</div>
          <div>{{ formattedMoney(totals()?.tax) }}</div>
        </div>

        <div class="flex-4">
          <div class="secondary-text-color scale85p">Total</div>
          <strong>{{ formattedMoney(totals()?.grandTotal) }}</strong>
        </div>
      </div>

      <hr />

      <!-- Fulfilment & Invoice -->
      <div class="row grid-gutter-1">
        <!-- Fulfilments -->
        <div class="flex-6">
          <div class="secondary-text-color scale85p">Fulfilments</div>

          @if (hasFulfilments()) {
          <a class="link"> {{ fulfilmentCount() }} fulfilment(s) </a>
          } @else {
          <div>None</div>
          }
        </div>

        <!-- Invoices -->
        <div class="flex-6">
          <div class="secondary-text-color scale85p">Invoices</div>

          @if (hasInvoices()) {
          <a class="link"> {{ invoiceCount() }} invoice(s) </a>
          } @else {
          <div>None</div>
          }
        </div>
      </div>
    </vcl-tab>
    <vcl-tab>
      <vcl-label>Items</vcl-label>
      <table
        class="table no-border fixed v-align-middle row-hover-highlight row-selectability"
        role="table"
      >
        <thead>
          <tr role="row">
            <th
              class="w-70p"
              role="columnheader"
              scope="col"
            >
              <span>Item</span>
            </th>

            <th
              class="w-10p"
              role="columnheader"
              scope="col"
              class="text-right"
            >
              <span>Qty</span>
            </th>

            <th
              class="w-10p"
              role="columnheader"
              scope="col"
              class="text-right"
            >
              <span>Unit price</span>
            </th>

            <th
              class="w-10p"
              role="columnheader"
              scope="col"
              class="text-right"
            >
              <span>Total</span>
            </th>
          </tr>
        </thead>
        <tbody>
          @for (item of order.items; track item.id) {
          <tr
            role="row"
            class="row-selectable"
          >
            <td role="cell">{{ item.productName }}</td>
            <td role="cell">{{ item.quantity }}</td>
            <td role="cell">
              {{ item.unitPrice?.amount | number : '1.2-2' | currency : 'EUR' }}
            </td>
            <td role="cell">
              {{
                item.totalPrice?.amount | number : '1.2-2' | currency : 'EUR'
              }}
              <!--
              TODO,
              {{ item.totalPrice?.currency -> SHOULD euro -> EUR }} -->
            </td>
          </tr>
          } @empty {
          <tr>
            <td
              colspan="4"
              class="muted"
            >
              No items in this order
            </td>
          </tr>
          }
        </tbody>
      </table>
    </vcl-tab>
    <vcl-tab>
      <vcl-label>History / Timeline</vcl-label>

      <div class="py-2 px-1">
        @for (item of order.history; track item.date) {
        <div class="row align-items-center">
          <!-- Timeline axis -->
          <div class="col align-items-center">
            <vcl-icon [icon]="item.icon ?? 'clock'" />
          </div>

          <!-- Timeline content -->
          <div class="flex col pl-3">
            <div class="row justify-between flex">
              <span class="timeline-title">
                {{ item.title }}
              </span>

              <span class="timeline-date secondary-text-color scale85p">
                {{ item.date | date : 'medium' }}
              </span>
            </div>

            @if (item.description) {
            <div class="timeline-description secondary-text-color">
              {{ item.description }}
            </div>
            }
          </div>
        </div>
        } @empty {
        <div class="align-centered py-4">
          <vcl-icon
            icon="history"
            size="24"
          />
          <h4>No history available</h4>
          <p class="secondary-text-color">
            This order has no recorded events yet.
          </p>
        </div>
        }
      </div>
    </vcl-tab>
    <vcl-tab>
      <vcl-label>Raw JSON / Meta</vcl-label>

      <div class="raw">
        <div class="secondary-text-color scale85p">Raw payload</div>
        <pre class="pre">{{ order | json }}</pre>
      </div>
    </vcl-tab>
  </vcl-tab-nav>
</rc-resource-detail>
}
