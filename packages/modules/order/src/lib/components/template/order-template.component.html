@if (vm$ | async; as vm) {
<rc-crud-main
  [feature]="feature"
  [title]="vm.selectedOrder?.customerOrderNr ?? feature.name.singular"
  [id]="vm.selectedOrderId"
  [total]="vm.dataList.length"
  [urlSegment]="vm.urlSegment"
  [triggerRead]="triggerRead"
  [triggerSelectId]="triggerSelectId"
  [triggerRemove]="triggerRemove"
  [triggerCreateInvoice]="triggerCreateInvoice"
  [triggerCreateFulfillment]="triggerCreateFulfillment"
  [schema]="orderSchema"
>
  <ng-container rc-crud-search>
    @if (vm.dataList.length > 0) {
    <div class="flex">
      <rc-searchbar
        [value]="triggerSearch.value"
        (search)="onSearch($event)"
      />
    </div>
    }
  </ng-container>

  <ng-container rc-crud-actions>
    <div class="flex">
      <vcl-form-control-group>
        <vcl-label>Change status</vcl-label>
        <vcl-select>
          <vcl-select-list
            (valueChange)="onChangeOrderStatus($event, vm.selectedOrder)"
            [value]="vm.selectedOrder?.orderState"
          >
            <vcl-select-list-item [value]="EOrderStatus.Pending">
              Pending
            </vcl-select-list-item>
            <vcl-select-list-item [value]="EOrderStatus.Submitted">
              Submitted
            </vcl-select-list-item>
            <vcl-select-list-item [value]="EOrderStatus.Completed">
              Completed
            </vcl-select-list-item>
            <vcl-select-list-item [value]="EOrderStatus.Cancelled">
              Cancelled
            </vcl-select-list-item>
            <vcl-select-list-item [value]="EOrderStatus.Withdrawn">
              Widthdrawn
            </vcl-select-list-item>
            <vcl-select-list-item [value]="EOrderStatus.Invalid">
              Invalid
            </vcl-select-list-item>
          </vcl-select-list>
        </vcl-select>
      </vcl-form-control-group>
    </div>
  </ng-container>

  <ng-container rc-crud-data-list>
    @if (vm.dataList.length > 0) {
    <rc-data-list
      [itemTemplate]="itemTemplate"
      [items]="vm.dataList"
      [selected]="vm.selectedOrderId"
      (itemSelected)="onItemSelected($event)"
    />
    } @else {
    <div class="pt-4">
      <rc-no-records message="No orders loaded" />
    </div>
    }
  </ng-container>

  <ng-container rc-crud-router-outlet>
    <router-outlet />
  </ng-container>

  <ng-container rc-crud-meta>
    @if (vm.selectedOrderId) {
    <rc-meta
      [id]="vm.selectedOrderId"
      [meta]="vm.selectedOrder?.meta"
    />
    }
  </ng-container>
</rc-crud-main>
}

<ng-template
  #itemTemplate
  let-item="item"
>
  <app-module-order-data-item [order]="item" />
</ng-template>
