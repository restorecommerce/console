<ng-container *ngIf="vm$ | async as vm">
  <div>
    <span
      #popoverOrganizationTarget
      class="inline-block"
    >
      <button
        vcl-button
        [selectable]="true"
        (click)="
          templatePopoverOrganization.toggle();
          onClickGlobalOrganizationSelector()
        "
        class="half-transparent organization"
      >
        <vcl-icogram>
          <vcl-icon icon="mdi:home-outline" />
          {{ vm.globalOrganization?.name }}
          <vcl-icon icon="mdi:chevron-down" />
        </vcl-icogram>
      </button>
    </span>

    <span
      #popoverAccountTarget
      class="inline-block"
    >
      <button
        vcl-button
        [selectable]="true"
        (click)="templatePopoverAccount.toggle()"
        class="half-transparent account"
      >
        <vcl-icogram>
          <vcl-icon icon="mdi:account-outline" />
          {{ vm.user?.fullName }}
          <vcl-icon icon="mdi:chevron-down" />
        </vcl-icogram>
      </button>
    </span>
  </div>

  <ng-template
    vclPopover
    #templatePopoverOrganization="vclPopover"
    [target]="popoverOrganizationTarget"
    [closeOnOffClick]="true"
    [positions]="rightOrientedPositions"
  >
    <div
      id="wrapper-popover-organization"
      class="data-list item-selectability item-hover-highlight m-0 p-0"
    >
      <rc-searchbar
        [value]="''"
        (search)="onSearchOrganizations($event)"
        class="m-0 p-0"
      />
      <div class="data-list m-0 p-0">
        <rc-data-list>
          <rc-data-list-item
            *ngFor="let o of vm.organizations"
            [ngClass]="{ selected: o?.id === vm.globalOrganization?.id }"
            role="option"
          >
            <rc-data-list-label
              [innerHTML]="o?.name"
              (click)="
                onSelectGlobalOrganization(
                  o?.id ?? '',
                  vm.globalOrganization?.id ?? ''
                );
                templatePopoverOrganization.close()
              "
            />
          </rc-data-list-item>
        </rc-data-list>
      </div>
    </div>
  </ng-template>

  <ng-template
    vclPopover
    #templatePopoverAccount="vclPopover"
    [target]="popoverAccountTarget"
    [closeOnOffClick]="true"
    [positions]="rightOrientedPositions"
  >
    <div
      id="wrapper-popover-account"
      class="data-list item-selectability item-hover-highlight m-0 p-0"
    >
      <ul
        class="data-list-body no-border"
        role="listbox"
        aria-multiselectable="false"
        (click)="templatePopoverAccount.close()"
      >
        <li
          [routerLink]="
            ROUTER.pages.main.children.account.children.profile.link
          "
          class="data-list-item row justify-between center"
        >
          <div class="flex">
            <vcl-icogram>
              <vcl-icon icon="mdi:account-cog-outline" />
            </vcl-icogram>
            <span class="text">Profile</span>
          </div>
        </li>
        <li
          [routerLink]="
            ROUTER.pages.main.children.account.children.preferences.link
          "
          class="data-list-item row justify-between center"
        >
          <div class="flex">
            <vcl-icogram>
              <vcl-icon icon="mdi:cog-outline" />
            </vcl-icogram>
            <span class="text">Preferences</span>
          </div>
        </li>
        <li
          [routerLink]="ROUTER.pages.main.children.auth.children.signOut.link"
          class="data-list-item row justify-between center"
        >
          <div class="flex">
            <vcl-icogram>
              <vcl-icon icon="mdi:logout" />
            </vcl-icogram>
            <span class="text red">Sign Out</span>
          </div>
        </li>
      </ul>
    </div>
  </ng-template>
</ng-container>
